<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <!-- SEO & Metadata -->
    <title>–°–í–Ü–¢–õ–û‚ö°–ë–ï–ó–ü–ï–ö–ê (–ö–∏—ó–≤) ‚Äî –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Å–≤—ñ—Ç–ª–∞ —Ç–∞ —Ç—Ä–∏–≤–æ–≥</title>
    <meta name="description" content="–ê–≤—Ç–æ–Ω–æ–º–Ω–∏–π –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –µ–ª–µ–∫—Ç—Ä–æ–ø–æ—Å—Ç–∞—á–∞–Ω–Ω—è, –ø–æ–≤—ñ—Ç—Ä—è–Ω–∏—Ö —Ç—Ä–∏–≤–æ–≥ —Ç–∞ —è–∫–æ—Å—Ç—ñ –ø–æ–≤—ñ—Ç—Ä—è —É –ö–∏—î–≤—ñ –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ. –î–∞–Ω—ñ Yasno, –î–¢–ï–ö —Ç–∞ SaveEcoBot.">
    <meta name="keywords" content="—Å–≤—ñ—Ç–ª–æ –∫–∏—ó–≤, –≥—Ä–∞—Ñ—ñ–∫ –≤—ñ–¥–∫–ª—é—á–µ–Ω—å, –ø–æ–≤—ñ—Ç—Ä—è–Ω–∞ —Ç—Ä–∏–≤–æ–≥–∞ –∫–∏—ó–≤, —è–∫—ñ—Å—Ç—å –ø–æ–≤—ñ—Ç—Ä—è –∫–∏—ó–≤, —Ä–∞–¥—ñ–∞—Ü—ñ—è –∫–∏—ó–≤, –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑–ø–µ–∫–∏">
    <meta name="author" content="Weby Homelab">
    
    <!-- Open Graph -->
    <meta property="og:title" content="–°–í–Ü–¢–õ–û‚ö°–ë–ï–ó–ü–ï–ö–ê (–ö–∏—ó–≤)">
    <meta property="og:description" content="–ñ–∏–≤–∏–π –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Å–≤—ñ—Ç–ª–∞ —Ç–∞ –±–µ–∑–ø–µ–∫–∏. –ü—Ä–∞—Ü—é—î –∞–≤—Ç–æ–Ω–æ–º–Ω–æ.">
    <meta property="og:image" content="/static/icon.svg">
    <meta property="og:url" content="https://flash.srvrs.top">
    
    <!-- PWA -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/static/icon.svg">
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-color: #050505;
            --card-bg: rgba(25, 25, 30, 0.6);
            --card-border: rgba(255, 255, 255, 0.08);
            --card-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            --text-primary: #ffffff;
            --text-secondary: #94a3b8;
            --accent: #a78bfa;
            --success: #34d399;
            --danger: #f87171;
            --warning: #fbbf24;
            --blur: 25px;
            
            /* Professional Muted Graph Colors */
            --color-graph-fact-on: #14b8a6;
            --color-graph-fact-off: #f43f5e;
            --color-graph-plan-on: #818cf8;
            --color-graph-plan-off: #64748b;
        }
        @media (prefers-color-scheme: light) {
            :root {
                --bg-color: #f3f4f6;
                --card-bg: rgba(255, 255, 255, 0.7);
                --card-border: rgba(0, 0, 0, 0.05);
                --card-shadow: 0 15px 40px rgba(0, 0, 0, 0.08);
                --text-primary: #111827;
                --text-secondary: #4b5563;
                --accent: #8b5cf6;
                --success: #059669;
                --danger: #dc2626;
                
                /* Light Mode Professional Muted */
                --color-graph-fact-on: #0f766e;
                --color-graph-fact-off: #be123c;
            }
        }
        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        html, body { 
            max-width: 100%; 
            overflow-x: hidden; 
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none;  /* IE/Edge */
        }
        html::-webkit-scrollbar, body::-webkit-scrollbar { 
            display: none; /* Chrome/Safari/Webkit */
        }
        body { background-color: var(--bg-color); color: var(--text-primary); font-family: 'Inter', sans-serif; min-height: 100vh; display: flex; flex-direction: column; align-items: center; padding: 24px 16px 60px; background-attachment: fixed; transition: background-color 0.3s; }
        body::before { content: ''; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: radial-gradient(circle at 10% 10%, rgba(167, 139, 250, 0.08) 0%, transparent 40%), radial-gradient(circle at 90% 90%, rgba(34, 211, 238, 0.08) 0%, transparent 40%); z-index: -1; }
        .container { width: 100%; max-width: 480px; }
        
        header { width: 100%; display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
        .logo { font-size: 1.2rem; font-weight: 800; letter-spacing: -0.03em; color: var(--text-primary); }
        .logo span { color: var(--accent); }

        /* Bell Icon Style */
        .bell-btn {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            width: 44px;
            height: 44px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.2rem;
            backdrop-filter: blur(10px);
            transition: all 0.2s;
            box-shadow: var(--card-shadow);
        }
        .bell-btn.off { opacity: 0.5; grayscale: 1; }
        .bell-btn:active { transform: scale(0.9); }

        .card { background: var(--card-bg); border: 1px solid var(--card-border); border-radius: 28px; padding: 24px; margin-bottom: 16px; backdrop-filter: blur(var(--blur)); -webkit-backdrop-filter: blur(var(--blur)); box-shadow: var(--card-shadow); position: relative; overflow: hidden; transition: transform 0.2s, background-color 0.3s, box-shadow 0.3s; }
        .card-label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.12em; color: var(--text-secondary); margin-bottom: 16px; display: block; font-weight: 700; }
        .status-row { display: flex; align-items: center; gap: 16px; width: 100%; }
        .status-icon { font-size: 2.2rem; }
        .status-title { font-size: 1.5rem; font-weight: 800; margin-bottom: 2px; }
        .status-desc { font-size: 0.95rem; color: var(--text-secondary); line-height: 1.4; font-weight: 500; }
        .status-on { border-color: rgba(52, 211, 153, 0.3); }
        .status-off { border-color: rgba(248, 113, 113, 0.3); }
        .alert-active { border-color: var(--danger); background: rgba(248, 113, 113, 0.15); animation: pulse-danger 2s infinite; }
        @keyframes pulse-danger { 0% { box-shadow: 0 0 0 0 rgba(248, 113, 113, 0.4); } 70% { box-shadow: 0 0 0 15px rgba(248, 113, 113, 0); } 100% { box-shadow: 0 0 0 0 rgba(248, 113, 113, 0); } }
        
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .grid-item { background: rgba(0,0,0,0.03); padding: 16px; border-radius: 20px; border: 1px solid var(--card-border); }
        @media (prefers-color-scheme: dark) { .grid-item { background: rgba(255,255,255,0.03); } }
        .grid-val { font-size: 1.25rem; font-weight: 700; }
        .grid-label { font-size: 0.65rem; color: var(--text-secondary); text-transform: uppercase; font-weight: 600; }
        
        .weather-info { margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--card-border); display: flex; justify-content: space-between; align-items: center; font-size: 0.85rem; color: var(--text-secondary); }
        .rad-norm { color: var(--success); font-weight: 700; }
        
        .section-header { margin: 24px 0 12px; font-size: 0.7rem; font-weight: 800; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.15em; display: flex; align-items: center; gap: 12px; }
        .section-header::after { content: ''; height: 1px; flex-grow: 1; background: var(--card-border); }
        
        .chart-wrap { border-radius: 24px; overflow: hidden; border: 1px solid var(--card-border); margin-top: 12px; background: #000; cursor: pointer; box-shadow: var(--card-shadow); }
        .chart-wrap img { width: 100%; display: block; }
        .schedule-text { background: var(--card-bg); border: 1px solid var(--card-border); border-radius: 28px; padding: 24px; font-family: 'Inter', sans-serif; font-size: 0.95rem; line-height: 1.7; white-space: pre-wrap; font-weight: 500; box-shadow: var(--card-shadow); color: var(--text-primary); backdrop-filter: blur(var(--blur)); -webkit-backdrop-filter: blur(var(--blur)); }
        
        .schedule-columns { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-top: 12px; }
        .col-header { font-size: 0.75rem; font-weight: 800; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px solid var(--card-border); }
        .col-header.on { color: #14b8a6; } /* teal */
        .col-header.off { color: #f43f5e; } /* rose */

        .schedule-date { color: var(--text-primary); font-weight: 600; margin-bottom: 20px; font-size: 1rem; }
        .schedule-line { display: flex; align-items: center; margin-bottom: 6px; font-variant-numeric: tabular-nums; font-size: 0.85rem; }
        .schedule-time { color: var(--text-primary); opacity: 0.85; width: 40px; text-align: center; }
        .time-sep { width: 12px; text-align: center; opacity: 0.4; }
        .schedule-duration { color: var(--text-secondary); margin-left: 8px; font-size: 0.8em; opacity: 0.6; }
        
        .schedule-line.off { color: #f43f5e !important; }
        .schedule-line.on { color: #14b8a6 !important; }

        .schedule-summary { border-top: 1px dashed var(--card-border); margin-top: 20px; padding-top: 16px; display: flex; gap: 24px; font-size: 1.1rem; }
        
        .light-hours { color: #14b8a6; font-weight: 700; text-shadow: 0 0 8px rgb(20 184 166 / 0.3); }
        .no-light-hours { color: #f43f5e; font-weight: 700; text-shadow: 0 0 8px rgb(244 63 94 / 0.3); }
        .schedule-divider { text-align: center; margin: 24px 0; opacity: 0.5; font-size: 0.8rem; letter-spacing: 4px; }
        
        .updated-time { color: var(--text-secondary); font-size: 0.85rem; margin-top: 12px; font-weight: 500; opacity: 0.8; }
        
        footer { margin-top: 40px; text-align: center; font-size: 0.8rem; color: var(--text-secondary); line-height: 1.6; }
        footer a { color: inherit; text-decoration: none; font-weight: 700; }
        
        #modal { display: none; position: fixed; z-index: 1000; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.98); padding: 16px; align-items: center; justify-content: center; }
        #modal img { max-width: 100%; max-height: 90vh; border-radius: 16px; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">–°–í–Ü–¢–õ–û<span>‚ö°</span>–ë–ï–ó–ü–ï–ö–ê</div>
            <div id="bell-btn" class="bell-btn off" onclick="toggleNotifications()" title="–£–≤—ñ–º–∫–Ω—É—Ç–∏ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è">üîï</div>
        </header>
        
        <div id="light-card" class="card"><div class="status-row"><div class="status-icon" id="light-icon">‚è≥</div><div class="status-info"><div class="status-title" id="light-text">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è</div><div class="status-desc" id="light-event">...</div></div></div></div>
        
        <div id="alert-card" class="card"><div class="status-row"><div class="status-icon" id="alert-icon">üõ°Ô∏è</div><div class="status-info"><div class="status-title" id="alert-val">---</div><div class="status-desc" id="alert-status">...</div></div></div></div>
        <div class="card" style="padding: 0; height: 320px; border: none; background: #000;"><iframe id="alert-map" src="https://alerts.in.ua/?minimal=true" width="100%" height="100%" frameborder="0" style="border:0;" allowfullscreen></iframe></div>
        
        <div class="section-header" id="aqi-loc">–Ø–∫—ñ—Å—Ç—å –ø–æ–≤—ñ—Ç—Ä—è</div>
        <div class="card">
            <div style="display: flex; align-items: baseline; gap: 12px; margin-bottom: 24px;"><span id="aqi-num" style="font-size: 3.5rem; font-weight: 800; line-height: 1;">--</span><div><div id="aqi-text" style="font-size: 1.2rem; font-weight: 700;">---</div><div style="font-size: 0.75rem; color: var(--text-secondary); font-weight: 600;">AQI INDEX</div></div></div>
            <div class="grid">
                <div class="grid-item"><div class="grid-val" id="pm25">--</div><div class="grid-label">PM2.5</div></div>
                <div class="grid-item"><div class="grid-val" id="pm10">--</div><div class="grid-label">PM10</div></div>
                <div class="grid-item"><div class="grid-val" id="temp">--</div><div class="grid-label">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</div></div>
                <div class="grid-item"><div class="grid-val" id="hum">--</div><div class="grid-label">–í–æ–ª–æ–≥—ñ—Å—Ç—å</div></div>
            </div>
            <div class="weather-info"><span id="wind-status">---</span><span id="rad-container">‚ò¢Ô∏è <span id="rad-val">--</span> –º–∫–ó–≤/–≥–æ–¥ <span class="rad-norm">(–Ω–æ—Ä–º–∞)</span></span></div>
        </div>
        
        <div class="section-header">–ê–Ω–∞–ª—ñ—Ç–∏–∫–∞ –∑–∞ —Å—å–æ–≥–æ–¥–Ω—ñ</div>
        <div class="chart-wrap" onclick="zoomImage(this.querySelector('img').src)"><img id="main-chart" src="/static/chart.png"></div>
        <div class="section-header">–¢–∏–∂–Ω–µ–≤–∏–π –∑–≤—ñ—Ç</div>
        <div class="chart-wrap" onclick="zoomImage(this.querySelector('img').src)"><img id="weekly-chart" src="/static/weekly.png"></div>
        <div class="section-header" id="group-schedule-header">–ì—Ä–∞—Ñ—ñ–∫</div>
        <div id="schedule-text" class="schedule-text">...</div>
        
        <footer>
            –û–Ω–æ–≤–ª–µ–Ω–æ: <span id="last-update">--:--:--</span><br>
            ¬© 2026 <a href="https://github.com/weby-homelab/flash-monitor-kyiv" target="_blank">Weby Homelab</a>
        </footer>
    </div>
    <div id="modal" onclick="this.style.display='none'"><img id="modal-img" src=""></div>
    
    <script>
        let lastLightStatus = null;
        let lastAlertStatus = null;
        let notificationsEnabled = localStorage.getItem('notifications') === 'true';
        const audio = new Audio('https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3'); // Light "ding"

        function updateBellUI() {
            const btn = document.getElementById('bell-btn');
            btn.innerText = notificationsEnabled ? 'üîî' : 'üîï';
            btn.className = notificationsEnabled ? 'bell-btn' : 'bell-btn off';
        }

        async function toggleNotifications() {
            if (!notificationsEnabled) {
                const permission = await Notification.requestPermission();
                if (permission === 'granted') {
                    notificationsEnabled = true;
                    localStorage.setItem('notifications', 'true');
                    showToast("–°–ø–æ–≤—ñ—â–µ–Ω–Ω—è —É–≤—ñ–º–∫–Ω–µ–Ω–æ");
                } else {
                    alert("–ë—É–¥—å –ª–∞—Å–∫–∞, –¥–æ–∑–≤–æ–ª—å—Ç–µ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è —É –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è—Ö –±—Ä–∞—É–∑–µ—Ä–∞");
                }
            } else {
                notificationsEnabled = false;
                localStorage.setItem('notifications', 'false');
            }
            updateBellUI();
        }

        function showToast(text) {
            console.log(text); // Placeholder for a toast if needed
        }

        function playDing() {
            if (notificationsEnabled) {
                audio.play().catch(e => console.log("Audio play failed:", e));
            }
        }

        function sendPush(title, body) {
            if (notificationsEnabled && Notification.permission === 'granted') {
                new Notification(title, { body, icon: '/static/icon.svg' });
            }
        }

        function zoomImage(src) { document.getElementById('modal-img').src = src; document.getElementById('modal').style.display = 'flex'; }
        function getTheme() { return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'; }
        function refreshCharts() {
            const t = Date.now();
            const theme = getTheme();
            const suffix = theme === 'light' ? '_light' : '';
            document.getElementById('main-chart').src = `/static/chart${suffix}.png?t=${t}`;
            document.getElementById('weekly-chart').src = `/static/weekly${suffix}.png?t=${t}`;
        }
        function updateMapTheme() {
            const isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const map = document.getElementById('alert-map');
            if (map) map.src = isDark ? "https://alerts.in.ua/?minimal=true&dark=1" : "https://alerts.in.ua/?minimal=true";
        }

        function update() {
            fetch('/api/status').then(r => r.json()).then(data => {
                // Light
                const lCard = document.getElementById('light-card');
                const currentLight = data.light;
                if (currentLight === 'on') { 
                    lCard.className = 'card status-on'; 
                    document.getElementById('light-icon').innerText = 'üí°'; 
                    document.getElementById('light-text').innerText = "–°–≤—ñ—Ç–ª–æ –∑'—è–≤–∏–ª–æ—Å—è"; 
                } else { 
                    lCard.className = 'card status-off'; 
                    document.getElementById('light-icon').innerText = '‚úñÔ∏è'; 
                    document.getElementById('light-text').innerText = '–°–≤—ñ—Ç–ª–æ –∑–Ω–∏–∫–ª–æ'; 
                }
                document.getElementById('light-event').innerHTML = data.light_event;
                
                if (lastLightStatus && currentLight !== lastLightStatus) {
                    playDing();
                    const statusText = currentLight === 'on' ? "–°–≤—ñ—Ç–ª–æ –∑'—è–≤–∏–ª–æ—Å—è!" : "–°–≤—ñ—Ç–ª–æ –∑–Ω–∏–∫–ª–æ!";
                    sendPush("‚ö° –°–í–Ü–¢–õ–û‚ö°–ë–ï–ó–ü–ï–ö–ê", statusText);
                    refreshCharts();
                }
                lastLightStatus = currentLight;

                // Group name
                if (data.group) { document.getElementById('group-schedule-header').innerText = '–ì—Ä–∞—Ñ—ñ–∫ –≥—Ä—É–ø–∏ ' + data.group; }

                // Alert
                const aCard = document.getElementById('alert-card');
                const isAlert = !!data.alert.city;
                if (isAlert) { 
                    aCard.className = 'card alert-active'; 
                    document.getElementById('alert-icon').innerText = 'üö®'; 
                    document.getElementById('alert-val').innerText = '–¢–†–ò–í–û–ì–ê'; 
                    document.getElementById('alert-status').innerText = '–ö–∏—ó–≤. –ü—Ä–æ–π–¥—ñ—Ç—å –≤ —É–∫—Ä–∏—Ç—Ç—è!'; 
                } else { 
                    aCard.className = 'card'; 
                    document.getElementById('alert-icon').innerText = 'üõ°Ô∏è'; 
                    document.getElementById('alert-val').innerText = '–°–ü–û–ö–Ü–ô–ù–û'; 
                    document.getElementById('alert-status').innerText = '–ö–∏—ó–≤. –¢—Ä–∏–≤–æ–≥–∏ –Ω–µ–º–∞—î'; 
                }

                if (lastAlertStatus !== null && isAlert !== lastAlertStatus) {
                    playDing();
                    const alertMsg = isAlert ? "–ü–æ—á–∞—Ç–æ–∫ –ø–æ–≤—ñ—Ç—Ä—è–Ω–æ—ó —Ç—Ä–∏–≤–æ–≥–∏!" : "–í—ñ–¥–±—ñ–π —Ç—Ä–∏–≤–æ–≥–∏";
                    sendPush("üö® –ü–û–í–Ü–¢–†–Ø–ù–ê –¢–†–ò–í–û–ì–ê", alertMsg);
                }
                lastAlertStatus = isAlert;
                
                document.getElementById('aqi-num').innerText = data.aqi.aqi;
                document.getElementById('aqi-text').innerText = data.aqi.text;
                document.getElementById('aqi-num').style.color = (data.aqi.aqi > 100) ? 'var(--danger)' : (data.aqi.aqi > 50) ? 'var(--warning)' : 'var(--success)';
                if (data.aqi.location) { document.getElementById('aqi-loc').innerText = data.aqi.location; }
                document.getElementById('pm25').innerText = data.aqi.pm25;
                document.getElementById('pm10').innerText = data.aqi.pm10;
                document.getElementById('temp').innerText = data.aqi.temp + '¬∞C';
                document.getElementById('hum').innerText = data.aqi.hum + '%';
                document.getElementById('wind-status').innerText = 'üí® ' + data.aqi.wind_dir + ', ' + data.aqi.wind_speed + ' –∫–º/–≥–æ–¥';
                document.getElementById('rad-val').innerText = data.radiation.level;
                document.getElementById('schedule-text').innerHTML = data.schedule_text;
                document.getElementById('last-update').innerText = data.timestamp;
            });
        }

        updateBellUI();
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => { updateMapTheme(); refreshCharts(); });
        updateMapTheme(); 
        setInterval(update, 30000); 
        update();

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js').then(reg => console.log('SW ok'));
            });
        }
    </script>
</body>
</html>
