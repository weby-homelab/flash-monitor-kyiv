import json
import re
from datetime import datetime
from zoneinfo import ZoneInfo

text = """
ะกะฒััะปะพะะพั โก๏ธ ะกะธะผะธัะตะฝะบะฐ 22-34ะ, [22.02.2026 21:15]
๐ข 21:15 ะกะฒััะปะพ ะท'ัะฒะธะปะพัั        
๐ ะะพะณะพ ะฝะต ะฑัะปะพ 4ะณะพะด 12ัะฒ

ะกะฒััะปะพะะพั โก๏ธ ะกะธะผะธัะตะฝะบะฐ 22-34ะ, [23.02.2026 6:36]
๐ด 06:30 ะกะฒััะปะพ ะทะฝะธะบะปะพ        
๐ ะะพะฝะพ ะฑัะปะพ 9ะณะพะด 15ัะฒ
๐ ะััะบััะผะพ ะทะฐ ะณัะฐััะบะพะผ ะพ 09:00

ะกะฒััะปะพะะพั โก๏ธ ะกะธะผะธัะตะฝะบะฐ 22-34ะ, [23.02.2026 8:40]
๐ข 08:40 ะกะฒััะปะพ ะท'ัะฒะธะปะพัั        
๐ ะะพะณะพ ะฝะต ะฑัะปะพ 2ะณะพะด 8ัะฒ
๐ ะะฐัััะฟะฝะต ะฟะปะฐะฝะพะฒะต: 13:00 - 20:00

ะกะฒััะปะพะะพั โก๏ธ ะกะธะผะธัะตะฝะบะฐ 22-34ะ, [23.02.2026 15:51]
๐ด 15:45 ะกะฒััะปะพ ะทะฝะธะบะปะพ        
๐ ะะพะฝะพ ะฑัะปะพ 7ะณะพะด 5ัะฒ
๐ ะััะบััะผะพ ะทะฐ ะณัะฐััะบะพะผ ะพ 20:00

ะกะฒััะปะพะะพั โก๏ธ ะกะธะผะธัะตะฝะบะฐ 22-34ะ, [23.02.2026 19:14]
๐ข 19:14 ะกะฒััะปะพ ะท'ัะฒะธะปะพัั        
๐ ะะพะณะพ ะฝะต ะฑัะปะพ 3ะณะพะด 27ัะฒ

ะกะฒััะปะพะะพั โก๏ธ ะกะธะผะธัะตะฝะบะฐ 22-34ะ, [24.02.2026 2:39]
๐ด 02:33 ะกะฒััะปะพ ะทะฝะธะบะปะพ        
๐ ะะพะฝะพ ะฑัะปะพ 7ะณะพะด 19ัะฒ
๐ ะััะบััะผะพ ะทะฐ ะณัะฐััะบะพะผ ะพ 05:00

ะกะฒััะปะพะะพั โก๏ธ ะกะธะผะธัะตะฝะบะฐ 22-34ะ, [24.02.2026 4:07]
๐ข 04:07 ะกะฒััะปะพ ะท'ัะฒะธะปะพัั        
๐ ะะพะณะพ ะฝะต ะฑัะปะพ 1ะณะพะด 32ัะฒ
๐ ะะฐัััะฟะฝะต ะฟะปะฐะฝะพะฒะต: 10:00 - 16:00

ะกะฒััะปะพะะพั โก๏ธ ะกะธะผะธัะตะฝะบะฐ 22-34ะ, [24.02.2026 13:12]
๐ด 13:06 ะกะฒััะปะพ ะทะฝะธะบะปะพ        
๐ ะะพะฝะพ ะฑัะปะพ 8ะณะพะด 59ัะฒ
๐ ะััะบััะผะพ ะทะฐ ะณัะฐััะบะพะผ ะพ 16:00

ะกะฒััะปะพะะพั โก๏ธ ะกะธะผะธัะตะฝะบะฐ 22-34ะ, [24.02.2026 15:37]
๐ข 15:37 ะกะฒััะปะพ ะท'ัะฒะธะปะพัั        
๐ ะะพะณะพ ะฝะต ะฑัะปะพ 2ะณะพะด 29ัะฒ
๐ ะะฐัััะฟะฝะต ะฟะปะฐะฝะพะฒะต: 22:30 - 00:00

ะกะฒััะปะพะะพั โก๏ธ ะกะธะผะธัะตะฝะบะฐ 22-34ะ, [25.02.2026 0:39]
๐ด 00:33 ะกะฒััะปะพ ะทะฝะธะบะปะพ        
๐ ะะพะฝะพ ะฑัะปะพ 8ะณะพะด 56ัะฒ
๐ ะััะบััะผะพ ะทะฐ ะณัะฐััะบะพะผ ะพ 02:00

ะกะฒััะปะพะะพั โก๏ธ ะกะธะผะธัะตะฝะบะฐ 22-34ะ, [25.02.2026 1:57]
๐ข 01:57 ะกะฒััะปะพ ะท'ัะฒะธะปะพัั        
๐ ะะพะณะพ ะฝะต ะฑัะปะพ 1ะณะพะด 22ัะฒ
๐ ะะฐัััะฟะฝะต ะฟะปะฐะฝะพะฒะต: 09:00 - 13:00

ะกะฒััะปะพะะพั โก๏ธ ะกะธะผะธัะตะฝะบะฐ 22-34ะ, [25.02.2026 10:34]
๐ด 10:28 ะกะฒััะปะพ ะทะฝะธะบะปะพ        
๐ ะะพะฝะพ ะฑัะปะพ 8ะณะพะด 31ัะฒ
๐ ะััะบััะผะพ ะทะฐ ะณัะฐััะบะพะผ ะพ 13:00

ะกะฒััะปะพะะพั โก๏ธ ะกะธะผะธัะตะฝะบะฐ 22-34ะ, [25.02.2026 12:57]
๐ข 12:57 ะกะฒััะปะพ ะท'ัะฒะธะปะพัั        
๐ ะะพะณะพ ะฝะต ะฑัะปะพ 2ะณะพะด 27ัะฒ
๐ ะะฐัััะฟะฝะต ะฟะปะฐะฝะพะฒะต: 18:30 - 23:00

ะกะฒััะปะพะะพั โก๏ธ ะกะธะผะธัะตะฝะบะฐ 22-34ะ, [25.02.2026 20:04]
๐ด 19:58 ะกะฒััะปะพ ะทะฝะธะบะปะพ        
๐ ะะพะฝะพ ะฑัะปะพ 7ะณะพะด 1ัะฒ
๐ ะััะบััะผะพ ะทะฐ ะณัะฐััะบะพะผ ะพ 23:00

ะกะฒััะปะพะะพั โก๏ธ ะกะธะผะธัะตะฝะบะฐ 22-34ะ, [25.02.2026 22:32]
๐ข 22:32 ะกะฒััะปะพ ะท'ัะฒะธะปะพัั        
๐ ะะพะณะพ ะฝะต ะฑัะปะพ 2ะณะพะด 32ัะฒ
๐ ะะฐัััะฟะฝะต ะฟะปะฐะฝะพะฒะต: 06:00 - 10:00

ะกะฒััะปะพะะพั โก๏ธ ะกะธะผะธัะตะฝะบะฐ 22-34ะ, [26.02.2026 6:10]
๐ด 06:04 ะกะฒััะปะพ ะทะฝะธะบะปะพ        
๐ ะะพะฝะพ ะฑัะปะพ 7ะณะพะด 32ัะฒ
๐ ะััะบััะผะพ ะทะฐ ะณัะฐััะบะพะผ ะพ 10:00

ะกะฒััะปะพะะพั โก๏ธ ะกะธะผะธัะตะฝะบะฐ 22-34ะ, [26.02.2026 10:39]
๐ข 10:39 ะกะฒััะปะพ ะท'ัะฒะธะปะพัั        
๐ ะะพะณะพ ะฝะต ะฑัะปะพ 4ะณะพะด 33ัะฒ
๐ ะะฐัััะฟะฝะต ะฟะปะฐะฝะพะฒะต: 14:30 - 20:30

ะกะฒััะปะพะะพั โก๏ธ ะกะธะผะธัะตะฝะบะฐ 22-34ะ, [26.02.2026 14:36]
๐ด 14:30 ะกะฒััะปะพ ะทะฝะธะบะปะพ        
๐ ะะพะฝะพ ะฑัะปะพ 3ะณะพะด 51ัะฒ
๐ ะััะบััะผะพ ะทะฐ ะณัะฐััะบะพะผ ะพ 20:30

ะกะฒััะปะพะะพั โก๏ธ ะกะธะผะธัะตะฝะบะฐ 22-34ะ, [26.02.2026 21:06]
๐ข 21:06 ะกะฒััะปะพ ะท'ัะฒะธะปะพัั        
๐ ะะพะณะพ ะฝะต ะฑัะปะพ 6ะณะพะด 34ัะฒ

ะกะฒััะปะพะะพั โก๏ธ ะกะธะผะธัะตะฝะบะฐ 22-34ะ, [27.02.2026 2:06]
๐ด 02:00 ะกะฒััะปะพ ะทะฝะธะบะปะพ        
๐ ะะพะฝะพ ะฑัะปะพ 4ะณะพะด 54ัะฒ
๐ ะััะบััะผะพ ะทะฐ ะณัะฐััะบะพะผ ะพ 07:30

ะกะฒััะปะพะะพั โก๏ธ ะกะธะผะธัะตะฝะบะฐ 22-34ะ, [27.02.2026 6:40]
๐ข 06:40 ะกะฒััะปะพ ะท'ัะฒะธะปะพัั        
๐ ะะพะณะพ ะฝะต ะฑัะปะพ 4ะณะพะด 38ัะฒ
๐ ะะฐัััะฟะฝะต ะฟะปะฐะฝะพะฒะต: 12:30 - 18:00
"""

lines = text.strip().split('\n')
events = []
current_date = None
kyiv_tz = ZoneInfo("Europe/Kyiv")

for line in lines:
    line = line.strip()
    if not line: continue
    
    date_match = re.search(r'\[(\d{2}\.\d{2}\.\d{4}) \d{1,2}:\d{2}\]', line)
    if date_match:
        current_date = date_match.group(1)
        continue
    
    if "ะกะฒััะปะพ ะท'ัะฒะธะปะพัั" in line or "ะกะฒััะปะพ ะทะฝะธะบะปะพ" in line:
        time_match = re.search(r'(\d{2}:\d{2})', line)
        if time_match and current_date:
            time_str = time_match.group(1)
            is_up = "ะกะฒััะปะพ ะท'ัะฒะธะปะพัั" in line
            event_type = "up" if is_up else "down"
            
            dt_str = f"{current_date} {time_str}"
            dt_obj = datetime.strptime(dt_str, "%d.%m.%Y %H:%M")
            dt_aware = dt_obj.replace(tzinfo=kyiv_tz)
            
            events.append({
                "timestamp": dt_aware.timestamp(),
                "event": event_type,
                "date_str": dt_aware.strftime("%Y-%m-%d %H:%M:%S")
            })

with open('/root/geminicli/flash-monitor-kyiv/event_log.json', 'w') as f:
    json.dump(events, f, indent=2)

print(f"Parsed {len(events)} events!")
print(f"Last event: {events[-1]}")
print(f"Penultimate event: {events[-2]}")
